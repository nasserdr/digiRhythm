<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Loading and preprocessing data in DigiRhythm • digiRhythm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Loading and preprocessing data in DigiRhythm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">digiRhythm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Actgram_diurnality_avg_activity.html">Visualizing actograms, average activity and diurnality index</a></li>
    <li><a class="dropdown-item" href="../articles/DFC_and_HP_and_changing_plots.html">Computing the DFC/HP and manipulating the functions returned objects</a></li>
    <li><a class="dropdown-item" href="../articles/Loading_and_preprocessing_data_in_DigiRhythm.html">Loading and preprocessing data in DigiRhythm</a></li>
    <li><a class="dropdown-item" href="../articles/Visualisation.html">Further options of visualization in DigiRhythm</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Loading and preprocessing data in DigiRhythm</h1>
                        <h4 data-toc-skip class="author">Hassan-Roland
Nasser and Marie Schneider</h4>
            
            <h4 data-toc-skip class="date">2024-07-30</h4>
      

      <div class="d-none name"><code>Loading_and_preprocessing_data_in_DigiRhythm.Rmd</code></div>
    </div>

    
    
<p>This Vignette will help you making sure that the data you provide to
DigiRhythm follows the library’s guideline. We will also make tackle few
useful utility functions that might be helpful, especially:</p>
<ul>
<li>import_raw_data_activity: a wrapper function that takes data where
date and time are in two separate columns and transform a dataset to a
digiRhythm friendly data set.</li>
<li>resample_dgm: this function increases the sampling period of a
digiRhythm friendly dataset. Usually, data are acquired in terms with
sampling period of seconds or minutes while most of the DigiRhythm
functions would be preferably run with a sampling period of 15
minutes.</li>
<li>is_dgm_friendly: this function will investigate whether a dataset is
digiRhythm friendly or not and will output a verbose explaining
why.</li>
</ul>
<div class="section level2">
<h2 id="loading-data-from-a-sample-csv-file">Loading data from a sample CSV file<a class="anchor" aria-label="anchor" href="#loading-data-from-a-sample-csv-file"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nasserdr.github.io/digiRhythm/">digiRhythm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A sample dataset could be found here</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/nasserdr/digiRhythm_sample_datasets/main/516b_2.csv"</span></span>
<span><span class="va">destination</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"516b_2.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, destfile <span class="op">=</span> <span class="va">destination</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># system(paste("head -n 15",  filename)) #Run it only on linux</span></span>
<span><span class="co"># IceTag ID:,,50001962,,,,</span></span>
<span><span class="co"># Site ID:,,n/a,,,,</span></span>
<span><span class="co"># Animal ID:,,n/a,,,,</span></span>
<span><span class="co"># First Record:,,30.04.2020,11:54:20,,,</span></span>
<span><span class="co"># Last Record:,,15.06.2020,11:06:55,,,</span></span>
<span><span class="co"># File Time Zone:,,W. Europe Standard Time,,,,</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Date,Time,Motion Index,Standing,Lying,Steps,Lying Bouts</span></span>
<span><span class="co"># 30.04.2020,11:54:20,0,0:00.0,0:40.0,0,0</span></span>
<span><span class="co"># 30.04.2020,11:55:00,0,0:00.0,1:00.0,0,0</span></span>
<span><span class="co"># 30.04.2020,11:56:00,0,0:00.0,1:00.0,0,0</span></span>
<span><span class="co"># 30.04.2020,11:57:00,0,0:00.0,1:00.0,0,0</span></span>
<span><span class="co"># 30.04.2020,11:58:00,0,0:00.0,1:00.0,0,0</span></span>
<span><span class="co"># 30.04.2020,11:59:00,0,0:00.0,1:00.0,0,0</span></span>
<span><span class="co"># 30.04.2020,12:00:00,0,0:00.0,1:00.0,0,0</span></span></code></pre></div>
<p>As shown in the previous lines, there are some information that are
not needed for working with the data, namely, the first 7 lines. The
date and time columns are in two separate columns. In this case, the
import_raw_activity_data function is useful. We did not really want to
make a universal import function because there might be an unlimited
number of cases. However, we only create a function called
import_raw_activity_data that solves a couple of most encountered
problems, namely the following:</p>
<ul>
<li>If the date and time are in two separate columns.</li>
<li>If the user wants to change the timezone of the data (by using the
arguments original_tz and target_tz).</li>
<li>If the user wants to change the sampling period directly.</li>
<li>If the user wants to remove the dates that do not contains a whole
day recording by using trim_first_day or trim_last_day or
trim_middle_days. If one of these arguments is TRUE, then the function
will remove the data of the first (or last day, respectively) if they
contains data less than 80% of what they are supposed to contains.</li>
</ul>
<p>For our particular example, as mentionned in the function call below,
we would like to skip 7 lines, we need to read 4 columns, we specified
the date and time formats, the separator, the original and target time
zones, the sampling rate and we want to remove all days that contains
less than 80% of data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_raw_activity_data.html">import_raw_activity_data</a></span><span class="op">(</span><span class="va">destination</span>,</span>
<span>  skipLines <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  act.cols.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Date"</span>, <span class="st">"Time"</span>, <span class="st">"Motion Index"</span>, <span class="st">"Steps"</span><span class="op">)</span>,</span>
<span>  date_format <span class="op">=</span> <span class="st">"%d.%m.%Y"</span>,</span>
<span>  time_format <span class="op">=</span> <span class="st">"%H:%M:%S"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">","</span>,</span>
<span>  original_tz <span class="op">=</span> <span class="st">"CET"</span>,</span>
<span>  target_tz <span class="op">=</span> <span class="st">"CET"</span>,</span>
<span>  sampling <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  trim_first_day <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  trim_middle_days <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  trim_last_day <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Reading the CSV file /tmp/Rtmpy0f1DG/516b_2.csv"</span></span>
<span><span class="co">#&gt; Removing the following columns because they are not numeric</span></span>
<span><span class="co">#&gt; [1] "First data points ... "</span></span>
<span><span class="co">#&gt;              datetime Motion.Index Steps</span></span>
<span><span class="co">#&gt; 1 2020-04-30 11:54:20            0     0</span></span>
<span><span class="co">#&gt; 2 2020-04-30 11:55:00            0     0</span></span>
<span><span class="co">#&gt; 3 2020-04-30 11:56:00            0     0</span></span>
<span><span class="co">#&gt; [1] "Last data point ... "</span></span>
<span><span class="co">#&gt;              datetime Motion.Index Steps</span></span>
<span><span class="co">#&gt; 1 2020-06-15 11:06:00            0     0</span></span>
<span><span class="co">#&gt; 2 2020-06-15 11:05:00            2     0</span></span>
<span><span class="co">#&gt; 3 2020-06-15 11:04:00            0     0</span></span>
<span><span class="co">#&gt; [1] "Minimum Required number of samples per day 76"</span></span>
<span><span class="co">#&gt; [1] "Returning a data frame with datetime colum and 2 variable colums"</span></span>
<span><span class="co">#&gt; [1] "Total number of samples is 4320 - Total number of days is 45"</span></span></code></pre></div>
<p>As Shown, the argument verbose = TRUE outputs some useful information
about the data loading process. We particularly mention the following
output: Minimum Required number of samples per day 76. The 76 is
obtained by computing 80% of the hypothetical data samples. In fact, if
the sampling period is 15 min, then we are supposed to have 96 samples
per day. 80% of the 96 samples is equal to 76, therefore, days with less
than 96 data points are removed.</p>
</div>
<div class="section level2">
<h2 id="checking-if-the-data-is-digirhythm-friendly">Checking if the data is digiRhythm friendly<a class="anchor" aria-label="anchor" href="#checking-if-the-data-is-digirhythm-friendly"></a>
</h2>
<p>Imposing a specific format on the dataset is a design choice. We
wanted to avoid future possible errors that might happen when user use
the library. A digiRhythm friendly dataset has the following properties:
- It has at least two columns. - The first column should be of a POSIX
format (datetime). - All other columns should be numeric. - The dataset
should contains data for 7 consecutive days at least (7 days are
required to compute the DFC).</p>
<p>The function [dgm_friendly()] returns a boolean. If verbose is set to
TRUE, it will output details about why or why not the data is not
considered digiRhythm friendly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is_dgm_friendly.html">is_dgm_friendly</a></span><span class="op">(</span><span class="va">data</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v Correct time format: </span>First column has a POSIXct Format </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v Number of days good for DFC: </span>46 days &gt;= 2 days </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v Correct numeric format - Column 2 ==&gt; Motion.Index</span> </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">v Correct numeric format - Column 3 ==&gt; Steps</span> </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">The data is digiRhythm friendly</span></span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="removing-outliers">Removing outliers<a class="anchor" aria-label="anchor" href="#removing-outliers"></a>
</h2>
<p>Sometimes, we may have outliers and want to remove them. Although the
outlier removal routine is not complicated, but providing an
off-the-shelve function for DGM friendly data is useful and might save
time. The [remove_activity_outliers()] (available inside utils.R) will
remove the outliers in all the non-POSIX columns. All data points that
lie out of the 2.5 and 97.5 percentiles are considered outliers.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_without_outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_activity_outliers.html">remove_activity_outliers</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_without_outliers</span><span class="op">)</span></span>
<span><span class="co">#&gt;              datetime Motion.Index Steps</span></span>
<span><span class="co">#&gt; 1 2020-05-01 00:00:00            0     0</span></span>
<span><span class="co">#&gt; 2 2020-05-01 00:15:00            7     0</span></span>
<span><span class="co">#&gt; 3 2020-05-01 00:30:00            3     0</span></span>
<span><span class="co">#&gt; 4 2020-05-01 00:45:00           39    13</span></span>
<span><span class="co">#&gt; 5 2020-05-01 01:00:00           37    16</span></span>
<span><span class="co">#&gt; 6 2020-05-01 01:15:00           33    14</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="resampling-data">Resampling data<a class="anchor" aria-label="anchor" href="#resampling-data"></a>
</h2>
<p>Often, data are acquired with milliseconds or seconds sampling
periods. However, transforming data to higher sampling periods is
recommended for some algorithms like the degree of functional coupling.
The library offers resampling function as it is useful in this case.
However, here are two considerations:</p>
<ul>
<li>The sampling period can be increased but not decreased. For
instance, we can transform data from 1 min sampling period to 15 minutes
sampling period.</li>
<li>The resampling concerns only activity variables where it makes sense
to make an additive resampling. For instance, if we are measuring the
number of steps every 1 min and we want to resample it to 15 minutes, we
can simply add all the steps during these 15 minutes. For other types of
variables, this might not be the case. For example, if we are measuring
the speed or the acceleration, addition would not probably make sense,
and a further transformation is required (in this case, it would be
dividing by 15 to obtain the average speed or acceleration). In other
case where the variable reflect a categorical entity that could be
transformed into a dummy variable, we argue that resampling would not at
all make sense.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resampled_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resample_dgm.html">resample_dgm</a></span><span class="op">(</span><span class="va">data</span>, new_sampling <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">resampled_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;              datetime Motion.Index Steps</span></span>
<span><span class="co">#&gt; 1 2020-05-01 00:00:00            0     0</span></span>
<span><span class="co">#&gt; 2 2020-05-01 00:15:00            7     0</span></span>
<span><span class="co">#&gt; 3 2020-05-01 00:30:00            3     0</span></span>
<span><span class="co">#&gt; 4 2020-05-01 00:45:00           39    13</span></span>
<span><span class="co">#&gt; 5 2020-05-01 01:00:00           37    16</span></span>
<span><span class="co">#&gt; 6 2020-05-01 01:15:00           33    14</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="periodicity-of-a-dataset">Periodicity of a dataset<a class="anchor" aria-label="anchor" href="#periodicity-of-a-dataset"></a>
</h2>
<p>Users can have access to the periodicity of a dataset using the
dgm_periodicity function as shown below: - The output of the function
shows the periodicity and start- and end-dates of the data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dgm_periodicity.html">dgm_periodicity</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hassan-Roland Nasser, Marie Schneider, Joanna Stachowicz, Christina Umstaetter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
